<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>SIGN IN</title>
		<script src="../../js/jquery.min.js"></script>
		<script src="../../js/md5.js"></script>
	</head>
	<body>
		<input id="txtUserName" type="text" placeholder="USER NAME ?" />
		<br />
		<input id="txtUserPass" type="password" placeholder="PASSWORD ?" />
		<br />
		<button onclick="getSeed();">SIGN IN</button>

		<script>
			function getSeed() {
				debugger;

				$.post('../../api/sign-in/new-seed', {}, (d, s) => {
					// console.log({d,s});
					try {
						if (d['ok'] == 1) {
							seed = d['result'];
							tryLogin(seed);
						}
					} catch (err) {
						console.log(err);
					}
				});
			}

			function tryLogin(seed) {
				// console.log(seed);
				let user_name = $('#txtUserName').val();
				let user_pass = $('#txtUserPass').val();

				let ph = getMd5(user_pass);
				let otp = getMd5(ph + seed);
				console.log('user_name: ' + user_name);
				console.log('client otp: ' + otp);

				// debugger;

				$.post('../../api/sign-in/', { user_name: user_name, otp: otp }, (d, s) => {
					console.log({ d, s });
				});
			}
		</script>
	</body>
</html>
